# This file is generated by Nx.
#
# Build the docker image with `nx build:docker backend`.
#
# Run the container with `docker run -p 3001:3001 -t backend`.
FROM docker.io/node:20.10.0-alpine

ENV HOST=0.0.0.0
ENV PORT=3001

WORKDIR /app

RUN addgroup --system backend && \
    adduser --system -G backend backend

COPY ../../package*.json .
# README: Why --ignore-scripts? https://github.com/typicode/husky/issues/920#issuecomment-809851650
RUN npm ci --only=production --ignore-scripts
COPY apps/backend/healthcheck.js .
COPY ../../dist/apps/backend .
RUN chown -R backend:backend .

# You can remove this install step if you build with `--bundle` option.
# The bundled output will include external dependencies.

CMD [ "node", "src/main.js" ]